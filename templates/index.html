{% extends 'layout.html' %}

{% block content %}
<h2>Stock Inventory</h2>

<form action="{{ url_for('search') }}" method="GET" style="margin-bottom: 20px;">
    <input type="text" name="query" placeholder="Search by product name, category, or supplier..." 
           value="{{ search_query if search_query else '' }}" style="width: 70%; display: inline-block;">
    <button type="submit" class="btn btn-primary">Search</button>
</form>

<table>
    <thead>
        <tr>
            <th>Sr.No</th>
            <th>Product Name</th>
            <th>Type</th>
            <th>Category</th>
            <th>Quantity</th>
            <th>Price (₹)</th>
            <th>Expiry Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if products %}
            {% for product in products %}
            <tr {% if product['quantity'] < 50 %}style="background-color: #fff3cd;"{% endif %}>
                <td>{{ loop.index }}</td>
                <td>{{ product['product_name'] }}</td>
                <td>{{ product['product_type'] }}</td>
                <td>{{ product['category'] }}</td>
                <td>
                    {{ product['quantity'] }} {{ product['unit'] }}
                    {% if product['quantity'] < 50 %}
                    <span style="color: orange; font-weight: bold;">⚠️</span>
                    {% endif %}
                </td>
                <td>₹{{ product['price'] }}</td>
                <td>{{ product['expiry_date'] }}</td>
                <td>
                    <a href="{{ url_for('view_product', id=product['id']) }}" class="btn btn-primary">View</a>
                    <a href="{{ url_for('update_product', id=product['id']) }}" class="btn btn-success">Edit</a>
                    <a href="{{ url_for('delete_product', id=product['id']) }}" 
                       class="btn btn-danger" 
                       onclick="return confirm('Are you sure you want to delete this product?')">Delete</a>
                </td>
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="8" style="text-align: center;">No products found. Add your first product!</td>
            </tr>
        {% endif %}
    </tbody>
</table>
{% endblock %}
